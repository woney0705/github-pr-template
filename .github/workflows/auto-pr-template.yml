name: Auto Apply PR Template

on:
  pull_request:
    types: [opened]

jobs:
  apply-template:
    runs-on: ubuntu-latest
    permissions:
      pull-requests: write
      contents: read
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Apply appropriate template
        uses: actions/github-script@v6
        with:
          script: |
            const fs = require('fs');
            const pr = context.payload.pull_request;
            const base = pr.base.ref;
            const body = pr.body || '';
            
            // PR bodyê°€ ë¹„ì–´ìˆê±°ë‚˜ ì§§ìœ¼ë©´ í…œí”Œë¦¿ ì ìš©
            if (body.length < 100) {
              let templatePath = '';
              
              // base ë¸Œëœì¹˜ì— ë”°ë¼ í…œí”Œë¦¿ ì„ íƒ
              if (base === 'backend') {
                templatePath = '.github/PULL_REQUEST_TEMPLATE/dev_be_pr_template.md';
              } else if (base === 'frontend') {
                templatePath = '.github/PULL_REQUEST_TEMPLATE/dev_fe_pr_template.md';
              } else if (base === 'stage') {
                templatePath = '.github/PULL_REQUEST_TEMPLATE/stage_pr_template.md';
              } else if (base === 'prod') {
                templatePath = '.github/PULL_REQUEST_TEMPLATE/prod_pr_template.md';
              }
              
              if (templatePath) {
                try {
                  const template = fs.readFileSync(templatePath, 'utf8');
                  
                  await github.rest.pulls.update({
                    owner: context.repo.owner,
                    repo: context.repo.repo,
                    pull_number: pr.number,
                    body: template
                  });
                  
                  await github.rest.issues.createComment({
                    owner: context.repo.owner,
                    repo: context.repo.repo,
                    issue_number: pr.number,
                    body: `âœ… **${base}** ë¸Œëœì¹˜ì— ë§ëŠ” PR í…œí”Œë¦¿ì´ ìë™ìœ¼ë¡œ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤!\n\ní…œí”Œë¦¿: \`${templatePath.split('/').pop()}\`\n\në‚´ìš©ì„ ì‘ì„±í•´ì£¼ì„¸ìš”! ğŸ“`
                  });
                } catch (error) {
                  console.error('Error applying template:', error);
                  
                  await github.rest.issues.createComment({
                    owner: context.repo.owner,
                    repo: context.repo.repo,
                    issue_number: pr.number,
                    body: `âš ï¸ PR í…œí”Œë¦¿ ì ìš© ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.\n\nì˜ˆìƒ í…œí”Œë¦¿: \`${templatePath}\`\n\nìˆ˜ë™ìœ¼ë¡œ í…œí”Œë¦¿ì„ ì‘ì„±í•´ì£¼ì„¸ìš”.`
                  });
                }
              }
            }
